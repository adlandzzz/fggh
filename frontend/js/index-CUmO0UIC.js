const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/ChatInterface-oAX4oegq.js","assets/vue-vendor-B2Mb1Gyl.js","assets/vue-vendor-CVJ-TES8.css","assets/utils-CYHRDsUm.js","assets/rolldown-runtime-CiX8ZqkN.js","assets/vendor-C6KcRxMA.js","assets/ui-vendor-CPReR_9n.js","assets/avatar-fallback-Cudijb_D.js","assets/useNotifications-DOSQL_7c.js","assets/useWebSocket-CHFm2kcX.js","assets/badge-BmYB0y3T.js","assets/ChatInterface-DPouxdWe.css","assets/ArchivedChats-DoQLw0f8.js","assets/select-dropdown-DOJG-wIS.js","assets/AdminPanel-CvcrLPgW.js","assets/tabs-content-D9xmU8fa.js","assets/ProfilePage-x9Y5SiFX.js","assets/LoginForm-D3aJjrM1.js","assets/ActivateInvitation-DjJdBTaJ.js","assets/ResetPassword-CCZfFCnx.js"])))=>i.map(i=>d[i]);
import{$ as N,B as $e,C as Ce,Ct as Y,Dt as W,E as Pe,Et as f,G as Te,I as Ee,J as ie,K as Ae,L as Le,O as Ue,P as ye,Q as Ie,R as ze,St as g,T as De,Tt as k,U as Re,V as Oe,W as je,X as ue,Z as ae,_t as be,a as Ne,at as x,b as Ve,bt as H,ct as w,dt as R,et as o,ht as u,i as Be,k as Me,kt as $,l as de,lt as We,mt as se,nt as D,ot as p,pt as oe,r as qe,rt as b,st as F,tt as T,v as Fe,vt as A,x as Je,xt as we,yt as Ke,z as Ze}from"./vue-vendor-B2Mb1Gyl.js";import{t as He}from"./utils-CYHRDsUm.js";import{n as Xe,t as Ye}from"./ui-vendor-CPReR_9n.js";import{t as Ge}from"./vendor-C6KcRxMA.js";(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const c of document.querySelectorAll('link[rel="modulepreload"]'))d(c);new MutationObserver(c=>{for(const l of c)if(l.type==="childList")for(const s of l.addedNodes)s.tagName==="LINK"&&s.rel==="modulepreload"&&d(s)}).observe(document,{childList:!0,subtree:!0});function r(c){const l={};return c.integrity&&(l.integrity=c.integrity),c.referrerPolicy&&(l.referrerPolicy=c.referrerPolicy),c.crossOrigin==="use-credentials"?l.credentials="include":c.crossOrigin==="anonymous"?l.credentials="omit":l.credentials="same-origin",l}function d(c){if(c.ep)return;c.ep=!0;const l=r(c);fetch(c.href,l)}})();const Qe=(...e)=>{},et=(...e)=>{console.error(...e)},tt=(...e)=>{},rt=(...e)=>{},at=(...e)=>{},n={log:Qe,error:et,warn:tt,info:rt,debug:at,isDebugMode:!1};var xe="/api/v1";n.log("üî• API MODULE LOADED - BASE_URL:",xe);const y=He.create({baseURL:xe,headers:{"Content-Type":"application/json",Accept:"application/json"},timeout:1e4});var ne="auth_token";function J(e){localStorage.setItem(ne,e),n.log("‚úÖ Token stored successfully")}function q(){return localStorage.getItem(ne)}function ke(){localStorage.removeItem(ne),n.log("üóëÔ∏è Token cleared")}function B(e){y.defaults.headers.common.Authorization=`Bearer ${e}`}function ce(){delete y.defaults.headers.common.Authorization,ke()}y.interceptors.request.use(e=>{const t=q();return t&&(e.headers.Authorization=`Bearer ${t}`),e});var G=!1;y.interceptors.response.use(e=>{const t=e.config?.url||"";return t.includes("/sessions/current")||n.log("‚úÖ SUCCESS Response from:",t,"- Status:",e.status),e},e=>{const t=e.config?.url||"";if(e.response?.status===404&&t.includes("/sessions/current"))return Promise.reject(e);if(e.response?.status===401){if(n.error("‚ùå 401 Unauthorized"),t.includes("/auth/login")||t.includes("/auth/register")||t.includes("/auth/activate")||t.includes("/auth/reset-password"))return n.warn("‚ö†Ô∏è Authentication failed - wrong credentials"),Promise.reject(e);if(t.includes("/users/")&&!t.includes("/users/profile")&&!t.includes("/users/change-password")||t.includes("/statistics/")||t.includes("/sessions/active")||t.includes("/settings/"))return n.warn("‚ö†Ô∏è Admin endpoint access denied"),Promise.reject(e);if(t.includes("/auth/me")||t.includes("/users/profile"))return n.warn("‚ö†Ô∏è getCurrentUser failed - token expired, clearing auth without redirect"),ce(),Promise.reject(e);n.error("‚ùå 401 Unauthorized on: %s",t),n.error("   Token present: %s",!!q()),n.error("   Current path: %s",window.location.pathname),n.error("   Error message: %s",e.response?.data?.error||e.message);const r=q();if(r)try{const d=JSON.parse(atob(r.split(".")[1])).exp*1e3,c=Date.now();if(d>c){const l=Math.floor((d-c)/1e3/60);return n.warn("‚ö†Ô∏è JWT —Ç–æ–∫–µ–Ω –µ—â–µ –≤–∞–ª–∏–¥–µ–Ω (–æ—Å—Ç–∞–ª–æ—Å—å %d –º–∏–Ω), –Ω–æ –ø–æ–ª—É—á–µ–Ω 401. –í–æ–∑–º–æ–∂–Ω–æ –≤—Ä–µ–º–µ–Ω–Ω–∞—è –ø—Ä–æ–±–ª–µ–º–∞ —Å Redis/–ë–î.",l),n.warn("   –ù–ï –≤—ã–ø–æ–ª–Ω—è–µ–º –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π logout - –ø—Ä–æ—Å—Ç–æ –≤–æ–∑–≤—Ä–∞—â–∞–µ–º –æ—à–∏–±–∫—É"),Promise.reject(e)}n.error("‚ùå JWT —Ç–æ–∫–µ–Ω —Ä–µ–∞–ª—å–Ω–æ –∏—Å—Ç–µ–∫ (exp: %s)",new Date(d).toLocaleString())}catch(d){n.error("‚ùå –ù–µ —É–¥–∞–ª–æ—Å—å —Ä–∞—Å–ø–∞—Ä—Å–∏—Ç—å JWT —Ç–æ–∫–µ–Ω:",d)}G||(G=!0,n.warn("üóëÔ∏è Clearing authentication due to expired/invalid token"),ce(),localStorage.removeItem("auth_user"),localStorage.removeItem("lastSyncTime"),window.location.pathname!=="/login"&&(n.info("üîÑ Redirecting to login due to expired token..."),window.location.href="/login"),setTimeout(()=>{G=!1},2e3))}return Promise.reject(e)});const M={login:async(e,t)=>{const r=await y.post("/auth/login",{email:e,password:t});n.log("üîç Login successful for user:",r.data.user?.email);const{token:d,user:c}=r.data;return J(d),B(d),n.log("‚úÖ Authentication completed"),c},register:async e=>{const{token:t,user:r}=(await y.post("/auth/register",e)).data;return J(t),B(t),r},refreshToken:async()=>{const e=q();if(!e)throw new Error("No token to refresh");const t=(await y.post("/auth/refresh",{token:e})).data.token;return J(t),B(t),t},logout:async()=>{ke(),delete y.defaults.headers.common.Authorization},getCurrentUser:async()=>{try{return(await y.get("/users/profile")).data}catch{return null}},updateProfile:async e=>(await y.put("/users/profile",e)).data,changePassword:async e=>{await y.put("/users/change-password",e)},getUsers:async()=>{try{const e=await y.get("/users");return n.log("üë• Users API response:",e.data),Array.isArray(e.data)?e.data:e.data&&Array.isArray(e.data.users)?e.data.users:(n.warn("‚ö†Ô∏è Unexpected users API response structure:",e.data),[])}catch(e){return n.error("‚ùå Error fetching users:",e),[{id:1,email:"manager@example.com",name:"–ê–ª–µ–∫—Å–µ–π –ü–µ—Ç—Ä–æ–≤",role:"manager",status:"online",avatar:"/manager-avatar.png"},{id:2,email:"admin@example.com",name:"–ú–∞—Ä–∏—è –ò–≤–∞–Ω–æ–≤–∞",role:"admin",status:"online",avatar:"/admin-avatar.png"}]}},createUser:async e=>(await y.post("/users",e)).data,updateUser:async(e,t)=>(await y.put(`/users/${e}`,t)).data,deleteUser:async e=>{await y.delete(`/users/${e}`,{timeout:9e4})},updateSettings:async(e,t)=>{await y.put(`/users/${e}/settings`,t)},inviteUser:async e=>(await y.post("/users/invite",e)).data,activateInvitation:async e=>{const t=await y.post("/auth/activate",e),{token:r}=t.data;return J(r),B(r),t.data},requestPasswordReset:async e=>{await y.post("/auth/forgot-password",e)},resetPassword:async e=>{await y.post("/auth/reset-password",e)},getUserSessions:async()=>(await y.get("/auth/sessions")).data.sessions,terminateSession:async e=>{await y.delete(`/auth/sessions/${e}`)},terminateAllSessions:async()=>{await y.delete("/auth/sessions")},createUserByAdmin:async e=>(await y.post("/users",e)).data};var V=e=>{e?document.documentElement.classList.add("dark"):document.documentElement.classList.remove("dark"),localStorage.setItem("darkTheme",e.toString()),n.log("üé® Theme applied:",e?"dark":"light")};const le=je("auth",()=>{const e=k(null),t=k(!0),r=N(()=>!!e.value);return{user:e,isLoading:t,isAuthenticated:r,login:async(a,m)=>{try{n.log("üîê Starting login for:",a);const _=await M.login(a,m);e.value=_,_.settings?.darkTheme!==void 0&&V(_.settings.darkTheme),n.log("‚úÖ Login successful for user:",_.email)}catch(_){throw n.error("‚ùå Login error:",_),_}},logout:async()=>{await M.logout(),e.value=null},initAuth:async()=>{try{const a=q();if(a){B(a);const m=await M.getCurrentUser();if(e.value=m,m?.settings?.darkTheme!==void 0)n.log("üé® Applying theme from DB:",m.settings.darkTheme),V(m.settings.darkTheme);else{const _=localStorage.getItem("darkTheme");n.log("üé® No theme in DB, checking localStorage:",_),V(_==="true")}n.log("‚úÖ Auth initialized for user:",m?.email)}else e.value=null}catch{n.error("‚ùå Auth initialization error"),e.value=null}finally{t.value=!1}},refreshUser:async()=>{try{const a=await M.getCurrentUser();a&&(e.value=a,a.settings?.darkTheme!==void 0&&V(a.settings.darkTheme),n.log("‚úÖ User data refreshed:",a.email))}catch(a){throw n.error("‚ùå Error refreshing user data:",a),a}}}});function U(...e){return Ye(Xe(e))}function jr(e){if(!e)return!1;try{const t=new URL(e);return!(!["http:","https:"].includes(t.protocol)||e.length>2048)}catch{return!1}}var st=w({__name:"button",props:{variant:{default:"default"},size:{default:"default"},as:{default:"button"}},setup(e){const t=Ge("inline-flex items-center justify-center whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:opacity-50",{variants:{variant:{default:"bg-primary text-primary-foreground hover:bg-primary/90",destructive:"bg-destructive text-destructive-foreground hover:bg-destructive/90",outline:"border border-input bg-background hover:bg-accent hover:text-accent-foreground",secondary:"bg-secondary text-secondary-foreground hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-10 px-4 py-2",sm:"h-9 rounded-md px-3",lg:"h-11 rounded-md px-8",icon:"h-10 w-10"}},defaultVariants:{variant:"default",size:"default"}});return(r,d)=>(u(),T(H(r.as),R({class:f(U)(f(t)({variant:r.variant,size:r.size}),r.$attrs.class)},r.$attrs),{default:g(()=>[A(r.$slots,"default")]),_:3},16,["class"]))}}),I=st,ot=w({__name:"label",setup(e){return(t,r)=>(u(),b("label",R({class:f(U)("text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70",t.$attrs.class)},t.$attrs),[A(t.$slots,"default")],16))}}),Q=ot,nt=w({__name:"card",setup(e){return(t,r)=>(u(),b("div",R({class:f(U)("rounded-lg border bg-card text-card-foreground shadow-sm",t.$attrs.class)},t.$attrs),[A(t.$slots,"default")],16))}}),ve=nt,lt=w({__name:"card-content",setup(e){return(t,r)=>(u(),b("div",R({class:f(U)("p-6 pt-0",t.$attrs.class)},t.$attrs),[A(t.$slots,"default")],16))}}),fe=lt,it=w({__name:"card-description",setup(e){return(t,r)=>(u(),b("p",R({class:f(U)("text-sm text-muted-foreground",t.$attrs.class)},t.$attrs),[A(t.$slots,"default")],16))}}),pe=it,ut=w({__name:"card-header",setup(e){return(t,r)=>(u(),b("div",R({class:f(U)("flex flex-col space-y-1.5 p-6",t.$attrs.class)},t.$attrs),[A(t.$slots,"default")],16))}}),ge=ut,dt=w({__name:"card-title",setup(e){return(t,r)=>(u(),b("h3",R({class:f(U)("text-2xl font-semibold leading-none tracking-tight",t.$attrs.class)},t.$attrs),[A(t.$slots,"default")],16))}}),me=dt,ct=w({__name:"alert",props:{variant:{}},setup(e){return(t,r)=>(u(),b("div",R({class:f(U)("relative w-full rounded-lg border p-4 [&>svg~*]:pl-7 [&>svg+div]:translate-y-[-3px] [&>svg]:absolute [&>svg]:left-4 [&>svg]:top-4 [&>svg]:text-foreground",t.variant==="destructive"?"border-destructive/50 text-destructive dark:border-destructive [&>svg]:text-destructive":"",t.$attrs.class)},t.$attrs),[A(t.$slots,"default")],16))}}),ee=ct,vt=w({__name:"alert-description",setup(e){return(t,r)=>(u(),b("div",R({class:f(U)("text-sm [&_p]:leading-relaxed",t.$attrs.class)},t.$attrs),[A(t.$slots,"default")],16))}}),te=vt,ft={class:"min-h-screen flex items-center justify-center bg-muted/30 p-4"},pt={class:"mx-auto w-12 h-12 bg-primary rounded-lg flex items-center justify-center"},gt={class:"space-y-2"},mt={class:"space-y-2"},_t={class:"relative"},ht=["type"],yt={class:"text-center mt-4"},bt={key:0,class:"fixed inset-0 bg-black/50 flex items-center justify-center p-4 z-50"},wt={class:"space-y-2"},xt={class:"flex gap-2"},kt=w({__name:"LoginForm",setup(e){const t=le(),r=k(""),d=k(""),c=k(!1),l=k(!1),s=k(""),a=k(!1),m=k(""),_=k(!1),h=k(""),S=k(""),P=async()=>{if(s.value="",!r.value||!r.value.includes("@")){s.value="–í–≤–µ–¥–∏—Ç–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π email –∞–¥—Ä–µ—Å";return}if(!d.value||d.value.length<3){s.value="–ü–∞—Ä–æ–ª—å –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –Ω–µ –º–µ–Ω–µ–µ 3 —Å–∏–º–≤–æ–ª–æ–≤";return}l.value=!0,n.log("Login attempt:",{email:r.value});try{await t.login(r.value,d.value)}catch(i){n.error("Login error:",i),i.response?.data?.error?s.value=i.response.data.error:i.response?.status===401?s.value="–ù–µ–≤–µ—Ä–Ω—ã–π email –∏–ª–∏ –ø–∞—Ä–æ–ª—å":i.response?.status===403?s.value="–î–æ—Å—Ç—É–ø –∑–∞–ø—Ä–µ—â–µ–Ω. –û–±—Ä–∞—Ç–∏—Ç–µ—Å—å –∫ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä—É.":i.response?.status>=500?s.value="–û—à–∏–±–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –ø–æ–∑–∂–µ.":i.code==="ECONNABORTED"?s.value="–ü—Ä–µ–≤—ã—à–µ–Ω–æ –≤—Ä–µ–º—è –æ–∂–∏–¥–∞–Ω–∏—è. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ.":i.message&&!i.message.includes("Network Error")?s.value=i.message:s.value="–ù–µ —É–¥–∞–ª–æ—Å—å –ø–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è –∫ —Å–µ—Ä–≤–µ—Ä—É"}finally{l.value=!1}},C=async()=>{_.value=!0,h.value="",S.value="";try{await M.requestPasswordReset({email:m.value}),S.value="–°—Å—ã–ª–∫–∞ –¥–ª—è —Å–±—Ä–æ—Å–∞ –ø–∞—Ä–æ–ª—è –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–∞ –Ω–∞ –≤–∞—à email",setTimeout(()=>{L()},3e3)}catch(i){n.error("Password reset error:",i),h.value=i.response?.data?.error||"–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ—Ç–ø—Ä–∞–≤–∫–µ —Å—Å—ã–ª–∫–∏ –¥–ª—è —Å–±—Ä–æ—Å–∞ –ø–∞—Ä–æ–ª—è"}finally{_.value=!1}},L=()=>{a.value=!1,m.value="",h.value="",S.value="",_.value=!1};return(i,v)=>(u(),b("div",ft,[p(ve,{class:"w-full max-w-md shadow-lg"},{default:g(()=>[p(ge,{class:"text-center space-y-4"},{default:g(()=>[o("div",pt,[p(f(ye),{class:"w-6 h-6 text-primary-foreground"})]),o("div",null,[p(me,{class:"text-2xl font-bold"},{default:g(()=>[...v[5]||(v[5]=[x("CRM –°–∏—Å—Ç–µ–º–∞",-1)])]),_:1}),p(pe,{class:"text-muted-foreground"},{default:g(()=>[...v[6]||(v[6]=[x(" –í–æ–π–¥–∏—Ç–µ –≤ —Å–∏—Å—Ç–µ–º—É –¥–ª—è –ø—Ä–æ–¥–æ–ª–∂–µ–Ω–∏—è —Ä–∞–±–æ—Ç—ã ",-1)])]),_:1})])]),_:1}),p(fe,null,{default:g(()=>[o("form",{onSubmit:ue(P,["prevent"]),class:"space-y-4"},[o("div",gt,[p(Q,{for:"email"},{default:g(()=>[...v[7]||(v[7]=[x("Email",-1)])]),_:1}),Y(o("input",{id:"email",type:"email",placeholder:"manager@mail.ru","onUpdate:modelValue":v[0]||(v[0]=E=>r.value=E),required:"",class:"flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50"},null,512),[[ie,r.value]])]),o("div",mt,[p(Q,{for:"password"},{default:g(()=>[...v[8]||(v[8]=[x("–ü–∞—Ä–æ–ª—å",-1)])]),_:1}),o("div",_t,[Y(o("input",{id:"password",type:c.value?"text":"password",placeholder:"–í–≤–µ–¥–∏—Ç–µ –ø–∞—Ä–æ–ª—å","onUpdate:modelValue":v[1]||(v[1]=E=>d.value=E),required:"",class:"flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 pr-10"},null,8,ht),[[Ae,d.value]]),p(I,{type:"button",variant:"ghost",size:"sm",class:"absolute right-0 top-0 h-full px-3 py-2 hover:bg-transparent",onClick:v[2]||(v[2]=E=>c.value=!c.value)},{default:g(()=>[c.value?(u(),T(f(Pe),{key:0,class:"h-4 w-4 text-muted-foreground"})):(u(),T(f(De),{key:1,class:"h-4 w-4 text-muted-foreground"}))]),_:1})])]),s.value?(u(),T(ee,{key:0,variant:"destructive"},{default:g(()=>[p(te,null,{default:g(()=>[x($(s.value),1)]),_:1})]),_:1})):D("",!0),p(I,{type:"submit",class:"w-full",disabled:l.value},{default:g(()=>[x($(l.value?"–í—Ö–æ–¥...":"–í–æ–π—Ç–∏"),1)]),_:1},8,["disabled"]),o("div",yt,[o("button",{type:"button",onClick:v[3]||(v[3]=E=>a.value=!0),class:"text-sm text-primary hover:underline"}," –ó–∞–±—ã–ª–∏ –ø–∞—Ä–æ–ª—å? ")])],32)]),_:1})]),_:1}),a.value?(u(),b("div",bt,[p(ve,{class:"w-full max-w-md"},{default:g(()=>[p(ge,null,{default:g(()=>[p(me,null,{default:g(()=>[...v[9]||(v[9]=[x("–°–±—Ä–æ—Å –ø–∞—Ä–æ–ª—è",-1)])]),_:1}),p(pe,null,{default:g(()=>[...v[10]||(v[10]=[x(" –í–≤–µ–¥–∏—Ç–µ email –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è —Å—Å—ã–ª–∫–∏ —Å–±—Ä–æ—Å–∞ –ø–∞—Ä–æ–ª—è ",-1)])]),_:1})]),_:1}),p(fe,null,{default:g(()=>[o("form",{onSubmit:ue(C,["prevent"]),class:"space-y-4"},[o("div",wt,[p(Q,{for:"reset-email"},{default:g(()=>[...v[11]||(v[11]=[x("Email",-1)])]),_:1}),Y(o("input",{id:"reset-email",type:"email","onUpdate:modelValue":v[4]||(v[4]=E=>m.value=E),required:"",class:"flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-sm"},null,512),[[ie,m.value]])]),h.value?(u(),T(ee,{key:0,variant:"destructive"},{default:g(()=>[p(te,null,{default:g(()=>[x($(h.value),1)]),_:1})]),_:1})):D("",!0),S.value?(u(),T(ee,{key:1,class:"bg-green-50 border-green-200"},{default:g(()=>[p(te,{class:"text-green-800"},{default:g(()=>[x($(S.value),1)]),_:1})]),_:1})):D("",!0),o("div",xt,[p(I,{type:"submit",disabled:_.value,class:"flex-1"},{default:g(()=>[x($(_.value?"–û—Ç–ø—Ä–∞–≤–∫–∞...":"–û—Ç–ø—Ä–∞–≤–∏—Ç—å"),1)]),_:1},8,["disabled"]),p(I,{type:"button",variant:"outline",onClick:L,class:"flex-1"},{default:g(()=>[...v[12]||(v[12]=[x(" –û—Ç–º–µ–Ω–∞ ",-1)])]),_:1})])],32)]),_:1})]),_:1})])):D("",!0)]))}}),St=kt,K=k([]),$t=1;function Se(){const e=s=>{const a=$t++;K.value.push({id:a,options:s});const m=s.duration||5e3;return setTimeout(()=>{t(a)},m+300),a},t=s=>{const a=K.value.findIndex(m=>m.id===s);a>-1&&K.value.splice(a,1)};return{toast:e,success:(s,a)=>e({title:s,description:a,variant:"success"}),error:(s,a)=>e({title:s,description:a,variant:"destructive"}),warning:(s,a)=>e({title:s,description:a,variant:"warning"}),info:(s,a)=>e({title:s,description:a,variant:"default"}),removeToast:t,toasts:K}}const Z=Se(),re={startWorkSession:async()=>(await y.post("/sessions/start")).data.session,endWorkSession:async()=>{await y.post("/sessions/end")},getCurrentSession:async()=>{try{return(await y.get("/sessions/current")).data.session}catch{return null}},getSessionHistory:async e=>{const t=e?{limit:e}:{};return(await y.get("/sessions/history",{params:t})).data.sessions},getActiveSessions:async()=>{try{return(await y.get("/sessions/active")).data?.sessions||[]}catch(e){return n.error("‚ùå Error fetching active sessions:",e),[]}}};var Ct={class:"w-64 bg-card border-r border-border flex flex-col m-4 mr-0 rounded-xl shadow-lg"},Pt={class:"p-6 border-b border-border"},Tt={class:"flex items-center gap-3"},Et={class:"w-10 h-10 bg-primary rounded-xl flex items-center justify-center shadow-lg"},At={class:"flex-1 p-4 space-y-2"},Lt={class:"font-medium pointer-events-none"},Ut={class:"p-4 border-t border-border space-y-3"},It={class:"bg-muted/50 p-4 rounded-lg border border-border"},zt={class:"flex items-center gap-3"},Dt={class:"w-10 h-10 rounded-lg bg-primary flex items-center justify-center shadow-sm"},Rt={class:"text-sm font-bold text-white"},Ot={class:"flex-1 min-w-0"},jt={class:"text-sm font-semibold text-foreground truncate"},Nt={class:"text-xs text-muted-foreground"},Vt={key:0,class:"mt-4 space-y-2"},Bt={key:0,class:"bg-green-50 dark:bg-green-500/10 border border-green-200 dark:border-green-500/30 rounded-lg p-3"},Mt={class:"text-xs text-green-600 dark:text-green-400/90"},Wt={key:1,class:"bg-muted/30 border border-border rounded-lg p-3"},qt=w({__name:"Sidebar",props:{activePage:{},onPageChange:{type:Function}},setup(e){const t=e,r=le(),d=[{id:"chats",label:"–ß–∞—Ç—ã",icon:Ve,available:!0},{id:"archived",label:"–ê—Ä—Ö–∏–≤",icon:Ee,available:!0},{id:"employees",label:"–ê–¥–º–∏–Ω –ø–∞–Ω–µ–ª—å",icon:Be,available:r.user?.role==="admin"||r.user?.role==="dev"},{id:"profile",label:"–ü—Ä–æ—Ñ–∏–ª—å",icon:Ne,available:!0}],c=N(()=>d.filter(i=>i.available)),l=i=>{n.log("[v0] Sidebar navigation clicked:",i),n.log("[v0] Current active page:",t.activePage),t.onPageChange(i),n.log("[v0] Page change handler called")},s=async()=>{try{await r.logout()}catch(i){n.error("Logout error:",i)}},a=k(null),m=k(!1),_=k(!1),h=async()=>{try{a.value=await re.getCurrentSession()}catch(i){n.error("Error loading current session:",i),a.value=null}},S=async()=>{if(n.log("startShift called, isStartingShift:",m.value),!m.value){m.value=!0;try{n.log("Starting work session...");const i=await re.startWorkSession();a.value=i,n.log("Shift started successfully:",i),Z.success("–°–º–µ–Ω–∞ –Ω–∞—á–∞—Ç–∞","–†–∞–±–æ—á–∞—è —Å–º–µ–Ω–∞ —É—Å–ø–µ—à–Ω–æ –æ—Ç–∫—Ä—ã—Ç–∞")}catch(i){n.error("Error starting shift:",i);const v=i instanceof Error?i.message:"–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –æ—à–∏–±–∫–∞";Z.error("–û—à–∏–±–∫–∞ –Ω–∞—á–∞–ª–∞ —Å–º–µ–Ω—ã",v)}finally{m.value=!1}}},P=async()=>{if(!_.value){_.value=!0;try{await re.endWorkSession(),a.value=null,n.log("Shift ended successfully"),window.dispatchEvent(new CustomEvent("session-ended")),Z.success("–°–º–µ–Ω–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∞","–†–∞–±–æ—á–∞—è —Å–º–µ–Ω–∞ —É—Å–ø–µ—à–Ω–æ –∑–∞–∫—Ä—ã—Ç–∞")}catch(i){n.error("Error ending shift:",i);const v=i instanceof Error?i.message:"–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –æ—à–∏–±–∫–∞";Z.error("–û—à–∏–±–∫–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è —Å–º–µ–Ω—ã",v)}finally{_.value=!1}}},C=i=>new Date(i).toLocaleTimeString("ru-RU",{hour:"2-digit",minute:"2-digit"}),L=()=>{n.log("üîÑ –ü–æ–ª—É—á–µ–Ω–æ —Å–æ–±—ã—Ç–∏–µ –∑–∞–∫—Ä—ã—Ç–∏—è —Å–º–µ–Ω—ã, –æ–±–Ω–æ–≤–ª—è–µ–º —Å–æ—Å—Ç–æ—è–Ω–∏–µ"),h()};return oe(()=>{r.user?.role==="manager"&&h(),window.addEventListener("session-ended",L)}),se(()=>{window.removeEventListener("session-ended",L)}),(i,v)=>(u(),b("div",Ct,[o("div",Pt,[o("div",Tt,[o("div",Et,[p(f(ye),{class:"w-6 h-6 text-white"})]),v[0]||(v[0]=o("div",null,[o("h1",{class:"font-bold text-foreground text-lg"},"Avito CRM")],-1))])]),o("nav",At,[(u(!0),b(ae,null,be(c.value,E=>(u(),T(I,{key:E.id,variant:i.activePage===E.id?"secondary":"ghost",class:W(f(U)("w-full justify-start gap-3 h-12 rounded-lg transition-all duration-200","cursor-pointer pointer-events-auto relative z-10",i.activePage===E.id&&"bg-blue-50 dark:bg-primary/20 text-blue-700 dark:text-primary-foreground border border-blue-200 dark:border-primary/40 shadow-sm",i.activePage!==E.id&&"hover:bg-gray-50 dark:hover:bg-secondary text-gray-700 dark:text-foreground hover:text-blue-600 dark:hover:text-primary")),onClick:Ir=>l(E.id),type:"button",role:"button",tabindex:"0"},{default:g(()=>[(u(),T(H(E.icon),{class:"w-5 h-5 pointer-events-none"})),o("span",Lt,$(E.label),1)]),_:2},1032,["variant","class","onClick"]))),128))]),o("div",Ut,[o("div",It,[o("div",zt,[o("div",Dt,[o("span",Rt,$(f(r).user?.name?.charAt(0)||"U"),1)]),o("div",Ot,[o("p",jt,$(f(r).user?.name),1),o("p",Nt,$(f(r).user?.role==="admin"?"–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä":f(r).user?.role==="dev"?"–†–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫":"–ú–µ–Ω–µ–¥–∂–µ—Ä"),1)])]),f(r).user?.role==="manager"?(u(),b("div",Vt,[a.value?(u(),b("div",Bt,[v[1]||(v[1]=o("div",{class:"flex items-center gap-2 mb-2"},[o("div",{class:"w-2 h-2 bg-green-500 rounded-full animate-pulse"}),o("span",{class:"text-sm font-medium text-green-800 dark:text-green-400"},"–°–º–µ–Ω–∞ –∞–∫—Ç–∏–≤–Ω–∞")],-1)),o("p",Mt," –ù–∞—á–∞—Ç–∞: "+$(C(a.value.started_at)),1),p(I,{onClick:P,variant:"outline",size:"sm",class:"w-full mt-2 text-red-600 dark:text-red-400 border-red-200 dark:border-red-500/30 hover:bg-red-50 dark:hover:bg-red-500/10 relative z-10 cursor-pointer",disabled:_.value},{default:g(()=>[p(f(Ue),{class:"w-3 h-3 mr-1"}),x(" "+$(_.value?"–ó–∞–≤–µ—Ä—à–µ–Ω–∏–µ...":"–ó–∞–≤–µ—Ä—à–∏—Ç—å —Å–º–µ–Ω—É"),1)]),_:1},8,["disabled"])])):(u(),b("div",Wt,[v[2]||(v[2]=o("div",{class:"flex items-center gap-2 mb-2"},[o("div",{class:"w-2 h-2 bg-muted-foreground/50 rounded-full"}),o("span",{class:"text-sm font-medium text-foreground"},"–°–º–µ–Ω–∞ –Ω–µ –Ω–∞—á–∞—Ç–∞")],-1)),v[3]||(v[3]=o("p",{class:"text-xs text-muted-foreground mb-2"}," –î–ª—è —Ä–∞–±–æ—Ç—ã —Å —á–∞—Ç–∞–º–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –Ω–∞—á–∞—Ç—å —Å–º–µ–Ω—É ",-1)),p(I,{onClick:S,variant:"outline",size:"sm",class:"w-full text-green-600 dark:text-green-400 border-green-200 dark:border-green-500/30 hover:bg-green-50 dark:hover:bg-green-500/10 relative z-10 cursor-pointer",disabled:m.value},{default:g(()=>[p(f(Fe),{class:"w-3 h-3 mr-1"}),x(" "+$(m.value?"–ù–∞—á–∞–ª–æ...":"–ù–∞—á–∞—Ç—å —Å–º–µ–Ω—É"),1)]),_:1},8,["disabled"])]))])):D("",!0)]),p(I,{variant:"ghost",class:"w-full justify-start gap-3 text-muted-foreground hover:text-red-600 dark:hover:text-red-400 hover:bg-red-50 dark:hover:bg-red-500/10 rounded-lg h-11 transition-all duration-200 cursor-pointer pointer-events-auto relative z-10",onClick:s,type:"button",role:"button",tabindex:"0"},{default:g(()=>[p(f(Je),{class:"w-4 h-4 pointer-events-none"}),v[4]||(v[4]=o("span",{class:"font-medium pointer-events-none"},"–í—ã–π—Ç–∏",-1))]),_:1})])]))}}),Ft=qt,Jt={class:"flex items-start gap-3"},Kt={class:"flex-shrink-0"},Zt={class:"flex-1 min-w-0"},Ht={class:"text-sm font-medium"},Xt={key:0,class:"text-sm text-muted-foreground mt-1"},Yt=w({__name:"toast",props:{title:{},description:{},variant:{default:"default"},duration:{default:5e3}},emits:["close"],setup(e,{expose:t,emit:r}){const d=e,c=r,l=k(!1),s=N(()=>{switch(d.variant){case"destructive":return de;case"success":return Me;case"warning":return de;default:return Ce}});let a=null;const m=()=>{l.value=!1,setTimeout(()=>{c("close")},300)},_=()=>{l.value=!0,a&&clearTimeout(a),d.duration>0&&(a=setTimeout(m,d.duration))};return oe(()=>{_()}),se(()=>{a&&clearTimeout(a)}),t({show:_,close:m}),(h,S)=>l.value?(u(),b("div",{key:0,class:W(f(U)("fixed top-4 right-4 z-50 w-96 max-w-sm rounded-lg border bg-background p-4 shadow-lg transition-all duration-300",h.variant==="destructive"?"border-destructive/50 text-destructive":"border-border",l.value?"translate-x-0 opacity-100":"translate-x-full opacity-0"))},[o("div",Jt,[o("div",Kt,[(u(),T(H(s.value),{class:W(f(U)("h-5 w-5",h.variant==="destructive"?"text-destructive":"text-primary"))},null,8,["class"]))]),o("div",Zt,[o("p",Ht,$(h.title),1),h.description?(u(),b("p",Xt,$(h.description),1)):D("",!0)]),o("button",{onClick:m,class:"flex-shrink-0 text-muted-foreground hover:text-foreground transition-colors"},[p(f(qe),{class:"h-4 w-4"})])])],2)):D("",!0)}}),Gt=Yt,Qt={class:"fixed top-4 right-4 z-50 space-y-2"},er=w({__name:"ToastContainer",setup(e){const{toasts:t,removeToast:r}=Se();return(d,c)=>(u(),b("div",Qt,[(u(!0),b(ae,null,be(f(t),l=>(u(),T(Gt,{key:l.id,title:l.options.title,description:l.options.description,variant:l.options.variant,duration:l.options.duration,onClose:s=>f(r)(l.id)},null,8,["title","description","variant","duration","onClose"]))),128))]))}}),tr=er,O=k(null);function rr(){return{confirm:d=>new Promise(c=>{O.value={...d,confirmText:d.confirmText||"–ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å",cancelText:d.cancelText||"–û—Ç–º–µ–Ω–∞",variant:d.variant||"default",resolve:c}}),confirmState:O,handleConfirm:()=>{O.value&&(O.value.resolve(!0),O.value=null)},handleCancel:()=>{O.value&&(O.value.resolve(!1),O.value=null)}}}const z=rr();var ar={key:0,class:"fixed inset-0 z-50 flex items-center justify-center p-4"},sr={class:"relative z-10 w-full max-h-[90vh] overflow-y-auto"},or=w({__name:"dialog",props:{open:{type:Boolean},maxWidth:{default:"max-w-lg"}},emits:["update:open"],setup(e,{emit:t}){const r=e,d=t,c=()=>{d("update:open",!1)};let l=0;return we(()=>r.open,s=>{s?(l=window.scrollY||document.documentElement.scrollTop,document.body.classList.add("dialog-open"),document.body.style.setProperty("overflow","hidden","important"),document.body.style.setProperty("top",`-${l}px`),document.documentElement.style.setProperty("overflow","hidden","important")):(document.body.classList.remove("dialog-open"),document.body.style.removeProperty("overflow"),document.body.style.removeProperty("top"),document.documentElement.style.removeProperty("overflow"),window.scrollTo(0,l))}),se(()=>{document.body.classList.remove("dialog-open"),document.body.style.removeProperty("overflow"),document.body.style.removeProperty("top"),document.documentElement.style.removeProperty("overflow")}),(s,a)=>(u(),T(Ie,{to:"body"},[s.open?(u(),b("div",ar,[o("div",{class:"fixed inset-0 bg-black/50",onClick:c}),o("div",sr,[o("div",{class:W(["relative bg-background rounded-lg shadow-lg mx-auto",s.maxWidth])},[A(s.$slots,"default")],2)])])):D("",!0)]))}}),nr=or,lr={class:"p-6"},ir=w({__name:"dialog-content",setup(e){return(t,r)=>(u(),b("div",lr,[A(t.$slots,"default")]))}}),ur=ir,dr={class:"flex flex-col space-y-1.5 text-center sm:text-left"},cr=w({__name:"dialog-header",setup(e){return(t,r)=>(u(),b("div",dr,[A(t.$slots,"default")]))}}),vr=cr,fr={class:"text-lg font-semibold leading-none tracking-tight"},pr=w({__name:"dialog-title",setup(e){return(t,r)=>(u(),b("h2",fr,[A(t.$slots,"default")]))}}),gr=pr,mr={class:"text-sm text-muted-foreground"},_r=w({__name:"dialog-description",setup(e){return(t,r)=>(u(),b("p",mr,[A(t.$slots,"default")]))}}),hr=_r,yr=w({__name:"dialog-footer",props:{class:{}},setup(e){const t=e,r=N(()=>t.class);return(d,c)=>(u(),b("div",{class:W(["flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2",f(U)("",r.value)])},[A(d.$slots,"default")],2))}}),br=yr,wr=w({__name:"ConfirmDialog",setup(e){const t=r=>{r||z.handleCancel()};return(r,d)=>(u(),T(nr,{open:!!f(z).confirmState.value,"onUpdate:open":t},{default:g(()=>[p(ur,null,{default:g(()=>[p(vr,null,{default:g(()=>[p(gr,null,{default:g(()=>[x($(f(z).confirmState.value?.title),1)]),_:1}),p(hr,null,{default:g(()=>[x($(f(z).confirmState.value?.message),1)]),_:1})]),_:1}),p(br,{class:"flex gap-2 sm:gap-0"},{default:g(()=>[p(I,{variant:"outline",onClick:f(z).handleCancel,class:"flex-1 sm:flex-initial"},{default:g(()=>[x($(f(z).confirmState.value?.cancelText),1)]),_:1},8,["onClick"]),p(I,{variant:f(z).confirmState.value?.variant==="destructive"?"destructive":"default",onClick:f(z).handleConfirm,class:"flex-1 sm:flex-initial"},{default:g(()=>[x($(f(z).confirmState.value?.confirmText),1)]),_:1},8,["variant","onClick"])]),_:1})]),_:1})]),_:1},8,["open"]))}}),_e=wr,xr="modulepreload",kr=function(e){return"/"+e},he={};const j=function(t,r,d){let c=Promise.resolve();if(r&&r.length>0){let _=function(h){return Promise.all(h.map(S=>Promise.resolve(S).then(P=>({status:"fulfilled",value:P}),P=>({status:"rejected",reason:P}))))};const s=document.getElementsByTagName("link"),a=document.querySelector("meta[property=csp-nonce]"),m=a?.nonce||a?.getAttribute("nonce");c=_(r.map(h=>{if(h=kr(h,d),h in he)return;he[h]=!0;const S=h.endsWith(".css"),P=S?'[rel="stylesheet"]':"";if(d)for(let L=s.length-1;L>=0;L--){const i=s[L];if(i.href===h&&(!S||i.rel==="stylesheet"))return}else if(document.querySelector(`link[href="${h}"]${P}`))return;const C=document.createElement("link");if(C.rel=S?"stylesheet":xr,S||(C.as="script"),C.crossOrigin="",C.href=h,m&&C.setAttribute("nonce",m),document.head.appendChild(C),S)return new Promise((L,i)=>{C.addEventListener("load",L),C.addEventListener("error",()=>i(new Error(`Unable to preload CSS for ${h}`)))})}))}function l(s){const a=new Event("vite:preloadError",{cancelable:!0});if(a.payload=s,window.dispatchEvent(a),!a.defaultPrevented)throw s}return c.then(s=>{for(const a of s||[])a.status==="rejected"&&l(a.reason);return t().catch(l)})};var Sr={key:1,class:"min-h-screen flex items-center justify-center"},$r={key:2,class:"flex h-screen relative overflow-hidden transition-colors duration-300 bg-background"},Cr={class:"flex-1 flex flex-col overflow-hidden relative z-10"},Pr={class:"flex-1 overflow-hidden p-6"},Tr={class:"border border-border rounded-xl p-4 h-full shadow-sm transition-all duration-300 overflow-auto bg-card backdrop-blur-sm"},Er=w({__name:"App",setup(e){const t=F(()=>j(()=>import("./ChatInterface-oAX4oegq.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11]))),r=F(()=>j(()=>import("./ArchivedChats-DoQLw0f8.js"),__vite__mapDeps([12,1,2,3,4,5,6,7,10,13]))),d=F(()=>j(()=>import("./AdminPanel-CvcrLPgW.js"),__vite__mapDeps([14,1,2,3,4,5,6,7,9,10,15,13]))),c=F(()=>j(()=>import("./ProfilePage-x9Y5SiFX.js"),__vite__mapDeps([16,1,2,3,4,5,6,8,10,15]))),l=le(),s=Ze(),a=$e(),m=k("chats");oe(()=>{l.initAuth()});const _=N(()=>s.path.startsWith("/login")||s.path.startsWith("/activate")||s.path.startsWith("/reset-password"));we(()=>l.isAuthenticated,P=>{P&&s.path==="/login"&&a.push("/")});const h=P=>{n.log("[v0] App received page change request:",P),n.log("[v0] Previous page:",m.value),m.value=P,n.log("[v0] New page set:",P)},S=N(()=>{switch(m.value){case"chats":return t;case"archived":return r;case"employees":return l.user?.role==="admin"||l.user?.role==="dev"?d:()=>We("div","–î–æ—Å—Ç—É–ø –∑–∞–ø—Ä–µ—â–µ–Ω");case"profile":return c;default:return t}});return(P,C)=>{const L=Ke("router-view");return u(),b(ae,null,[_.value?(u(),T(L,{key:0})):f(l).isLoading?(u(),b("div",Sr,[...C[0]||(C[0]=[o("div",{class:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary"},null,-1)])])):f(l).isAuthenticated?(u(),b("div",$r,[C[1]||(C[1]=o("div",{class:"absolute inset-0 opacity-10 dark:opacity-[0.07] pointer-events-none"},[o("div",{class:"absolute top-0 left-1/4 w-96 h-96 rounded-full blur-3xl animate-pulse bg-blue-200 dark:bg-blue-500/15",style:{"will-change":"opacity",transform:"translateZ(0)"}}),o("div",{class:"absolute bottom-0 right-1/4 w-80 h-80 rounded-full blur-3xl animate-pulse bg-green-200 dark:bg-emerald-500/15",style:{"will-change":"opacity",transform:"translateZ(0)"}}),o("div",{class:"absolute top-1/2 left-1/2 w-64 h-64 rounded-full blur-3xl animate-pulse bg-yellow-200/50 dark:bg-violet-500/10",style:{"will-change":"opacity",transform:"translate(-50%, -50%) translateZ(0)"}})],-1)),p(Ft,{"active-page":m.value,onPageChange:h},null,8,["active-page"]),o("div",Cr,[o("main",Pr,[o("div",Tr,[(u(),T(H(S.value),{onPageChange:h},null,32))])])]),p(tr),p(_e)])):(u(),T(St,{key:3})),f(l).isAuthenticated?D("",!0):(u(),T(_e,{key:4}))],64)}}}),Ar=Er,Lr=Le({history:ze("/"),routes:[{path:"/login",name:"login",component:()=>j(()=>import("./LoginForm-D3aJjrM1.js"),__vite__mapDeps([17,1,2,3,4,5,6]))},{path:"/activate",name:"activate",component:()=>j(()=>import("./ActivateInvitation-DjJdBTaJ.js"),__vite__mapDeps([18,1,2,3,4]))},{path:"/reset-password",name:"reset-password",component:()=>j(()=>import("./ResetPassword-CCZfFCnx.js"),__vite__mapDeps([19,1,2,3,4]))}]}),Ur=Lr,X=Te(Ar);X.use(Re());X.use(Ur);X.use(Oe);X.mount("#app");export{n as C,y as S,I as _,ur as a,le as b,re as c,me as d,ge as f,Q as g,ve as h,vr as i,Z as l,fe as m,hr as n,nr as o,pe as p,gr as r,z as s,br as t,St as u,U as v,M as x,jr as y};
