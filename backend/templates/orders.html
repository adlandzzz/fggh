<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TBGSOSAT - –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∑–∞–∫–∞–∑–∞–º–∏</title>
    <link rel="stylesheet" href="/static/css/old-style.css">
    <style>
        .orders-grid {
            display: grid;
            gap: 1.5rem;
        }

        .order-card {
            background: var(--card);
            border: 1px solid var(--border);
            border-radius: 8px;
            padding: 1.5rem;
            transition: all 0.2s ease;
        }

        .order-card:hover {
            border-color: var(--primary);
            transform: translateY(-2px);
        }

        .order-header {
            display: flex;
            justify-content: space-between;
            align-items: start;
            margin-bottom: 1rem;
        }

        .order-status {
            padding: 0.25rem 0.75rem;
            border-radius: 6px;
            font-size: 0.75rem;
            font-weight: 600;
        }

        .status-pending { background: #fef3c7; color: #92400e; }
        .status-in_progress { background: #dbeafe; color: #1e40af; }
        .status-completed { background: #d1fae5; color: #065f46; }

        .order-price {
            font-size: 1.25rem;
            font-weight: bold;
            color: var(--primary);
        }
    </style>
</head>
<body>
    <header class="header">
        <div class="container">
            <div class="header-content">
                <a href="/" class="logo">TBGSOSAT ORDERS</a>
                <nav class="nav">
                    <a href="/" class="nav-link">üè† –ì–ª–∞–≤–Ω–∞—è</a>
                    <a href="/dashboard" class="nav-link">üìä –î–∞—à–±–æ—Ä–¥</a>
                    <a href="/admin" class="nav-link">‚öôÔ∏è –ê–¥–º–∏–Ω–∫–∞</a>
                    <a href="/orders" class="nav-link active">üì¶ –ó–∞–∫–∞–∑—ã</a>
                </nav>
            </div>
        </div>
    </header>

    <main class="main-content">
        <div class="container">
            <div class="card-header" style="margin-bottom: 2rem;">
                <h1 class="card-title">üì¶ –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∑–∞–∫–∞–∑–∞–º–∏</h1>
                <button class="btn" onclick="showAddOrderModal()">+ –ù–æ–≤—ã–π –∑–∞–∫–∞–∑</button>
            </div>

            <div class="stats-grid" style="margin-bottom: 2rem;">
                <div class="stat-card">
                    <div class="stat-icon">üìã</div>
                    <div class="stat-value" id="total-orders">0</div>
                    <div class="stat-label">–í—Å–µ–≥–æ –∑–∞–∫–∞–∑–æ–≤</div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon">‚è≥</div>
                    <div class="stat-value" id="pending-orders">0</div>
                    <div class="stat-label">–í –æ–∂–∏–¥–∞–Ω–∏–∏</div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon">‚úÖ</div>
                    <div class="stat-value" id="completed-orders">0</div>
                    <div class="stat-label">–ó–∞–≤–µ—Ä—à–µ–Ω–æ</div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon">üí∞</div>
                    <div class="stat-value" id="total-revenue">0‚ÇΩ</div>
                    <div class="stat-label">–í—ã—Ä—É—á–∫–∞</div>
                </div>
            </div>

            <div class="orders-grid" id="orders-container">
                <!-- –ó–∞–∫–∞–∑—ã –∑–∞–≥—Ä—É–∂–∞—é—Ç—Å—è —á–µ—Ä–µ–∑ JavaScript -->
            </div>
        </div>
    </main>

    <script>
        async function loadOrders() {
            try {
                const response = await fetch('/api/orders/list');
                const orders = await response.json();

                // –û–±–Ω–æ–≤–ª—è–µ–º —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É
                document.getElementById('total-orders').textContent = orders.length;
                document.getElementById('pending-orders').textContent = orders.filter(o => o.status === 'pending').length;
                document.getElementById('completed-orders').textContent = orders.filter(o => o.status === 'completed').length;

                const totalRevenue = orders
                    .filter(o => o.status === 'completed')
                    .reduce((sum, order) => sum + (order.price || 0), 0);
                document.getElementById('total-revenue').textContent = totalRevenue + '‚ÇΩ';

                // –û—Ç–æ–±—Ä–∞–∂–∞–µ–º –∑–∞–∫–∞–∑—ã
                const container = document.getElementById('orders-container');
                container.innerHTML = orders.map(order => `
                    <div class="order-card">
                        <div class="order-header">
                            <div>
                                <h3 style="margin: 0 0 0.5rem 0;">${order.title}</h3>
                                <p style="color: var(--muted-foreground); margin: 0;">${order.description}</p>
                            </div>
                            <div style="text-align: right;">
                                <div class="order-status status-${order.status}">
                                    ${getStatusText(order.status)}
                                </div>
                                <div class="order-price">${order.price || 0}‚ÇΩ</div>
                            </div>
                        </div>
                        <div style="display: flex; justify-content: space-between; align-items: center;">
                            <div>
                                <small style="color: var(--muted-foreground);">
                                    –ö–ª–∏–µ–Ω—Ç: ${order.username}<br>
                                    –°–æ–∑–¥–∞–Ω: ${new Date(order.created_at).toLocaleDateString()}
                                </small>
                            </div>
                            <div style="display: flex; gap: 0.5rem;">
                                <button class="btn btn-outline" onclick="editOrder(${order.id})">‚úèÔ∏è</button>
                                <button class="btn btn-outline" onclick="viewOrder(${order.id})">üëÅÔ∏è</button>
                            </div>
                        </div>
                    </div>
                `).join('');
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∑–∞–∫–∞–∑–æ–≤:', error);
            }
        }

        function getStatusText(status) {
            const statusMap = {
                'pending': '–í –æ–∂–∏–¥–∞–Ω–∏–∏',
                'in_progress': '–í —Ä–∞–±–æ—Ç–µ',
                'completed': '–ó–∞–≤–µ—Ä—à–µ–Ω–æ'
            };
            return statusMap[status] || status;
        }

        function showAddOrderModal() {
            alert('–§–æ—Ä–º–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –∑–∞–∫–∞–∑–∞ –±—É–¥–µ—Ç –∑–¥–µ—Å—å');
        }

        function editOrder(orderId) {
            alert(`–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∑–∞–∫–∞–∑–∞ ID: ${orderId}`);
        }

        function viewOrder(orderId) {
            alert(`–ü—Ä–æ—Å–º–æ—Ç—Ä –∑–∞–∫–∞–∑–∞ ID: ${orderId}`);
        }

        // –ó–∞–≥—Ä—É–∂–∞–µ–º –∑–∞–∫–∞–∑—ã –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ
        document.addEventListener('DOMContentLoaded', loadOrders);
    </script>
</body>
</html>